/** Optional Sheet menu helpers (inside the spreadsheet) */
function onOpen(){ SpreadsheetApp.getUi().createMenu('Cascade Tools').addItem('Normalize New Rows','normalizeNewRows').addItem('Recompute Categories','recomputeCategories').addToUi(); }
function normalizeNewRows(){ const sh=SpreadsheetApp.getActive().getActiveSheet(); const last=sh.getLastRow(); if(last<2) return; const rng=sh.getRange(2,1,last-1,26); const v=rng.getValues(); v.forEach(r=>{ if(typeof r[0]==='string'){ const d=new Date(r[0]); if(!isNaN(d)) r[0]=d; } [6,11,12].forEach(i=>{ const s=r[i]; if(typeof s==='string'){ const n=parseFloat(String(s).replace(/[^\d.]/g,'')); if(!isNaN(n)) r[i]=n; } }); if(!r[1]) r[1]='Cascade Hideaway_BRIA'; }); rng.setValues(v); }
function recomputeCategories(){ const sh=SpreadsheetApp.getActive().getActiveSheet(); const last=sh.getLastRow(); if(last<2) return; const rng=sh.getRange(2,1,last-1,26); const v=rng.getValues(); const cats=new Set(['Utilities','Subscriptions','Services','Maintenance','Repairs','Supplies','Cleaning','Internet','Electricity','Water','Gas','Waste','Landscaping','Security','Insurance','Taxes','Fees','Professional Services','Software','Travel','Meals','Office','Shipping','Medical','Equipment','Other']); v.forEach(r=>{ if(!r[4]){ const hay=(r[2]||'')+' '+(r[3]||''); const map=[[/(electric|kwh|power|energy|electricity)/i,'Electricity'],[/water|maynilad|manila water/i,'Water'],[/internet|wifi|fiber|converge|pldt/i,'Internet'],[/subscription|saas|netflix|spotify|adobe/i,'Subscriptions']]; for(var i=0;i<map.length;i++){ if(map[i][0].test(hay)){ r[4]=map[i][1]; break; } } if(!r[4]) r[4]='Other'; } if(!cats.has(r[4])) r[4]='Other'; }); rng.setValues(v); }
