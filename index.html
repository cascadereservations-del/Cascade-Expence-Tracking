<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <title>Expense Capture — AI-Ready</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/zod@3.23.8/lib/index.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.min.mjs" type="module"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body class="h-full bg-neutral-50 text-neutral-900">
    <header class="sticky top-0 z-20 bg-white/90 backdrop-blur border-b">
      <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
        <h1 class="text-xl font-semibold">Expense Data Capture</h1>
        <div class="flex items-center gap-3">
          <button id="themeToggle" class="px-3 py-1.5 rounded border text-sm">Theme</button>
          <span id="appStatus" class="text-xs text-neutral-500" aria-live="polite"></span>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-4 py-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
      <section class="lg:col-span-1 space-y-4">
        <div class="card">
          <div class="card-header">Ingest</div>
          <div class="card-body space-y-3">
            <label class="block">
              <span class="label">Upload images/PDF</span>
              <input id="fileInput" type="file" accept=".pdf,image/*" multiple class="input" />
            </label>

            <div>
              <div class="flex items-center justify-between">
                <span class="label">Paste raw text / email</span>
                <button id="parsePasteBtn" class="btn-secondary text-xs">Parse</button>
              </div>
              <textarea id="pasteBox" rows="6" class="textarea" placeholder="Paste any receipt text, bank line item, or email here..."></textarea>
            </div>

            <div class="text-xs text-neutral-500">
              OCR runs locally by default. LLM parsing is off unless enabled in Settings.
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">Settings</div>
          <div class="card-body space-y-3">
            <div class="grid grid-cols-2 gap-3">
              <label class="block col-span-2">
                <span class="label">Default Drive Folder ID (optional)</span>
                <input id="driveFolderId" class="input" placeholder="e.g. 1ZVwc58gkaNWW8rw2tbbCUJRIQWhkPEnz" />
              </label>

              <label class="block">
                <span class="label">Google Client ID</span>
                <input id="googleClientId" class="input" placeholder="OAuth Client ID" />
              </label>

              <div class="flex items-end gap-2">
                <button id="googleSignIn" class="btn">Sign in</button>
                <span id="googleUser" class="text-xs text-neutral-500"></span>
              </div>

              <label class="block col-span-2">
                <span class="label">Gemini API Key (optional)</span>
                <input id="geminiKey" class="input" placeholder="GEMINI_API_KEY" />
              </label>

              <div class="col-span-2 grid grid-cols-2 gap-2">
                <label class="flex items-center gap-2 text-sm">
                  <input id="toggleTesseract" type="checkbox" class="checkbox" checked />
                  <span>Use Tesseract (client OCR)</span>
                </label>
                <label class="flex items-center gap-2 text-sm">
                  <input id="toggleLLM" type="checkbox" class="checkbox" />
                  <span>Allow LLM network</span>
                </label>
                <label class="flex items-center gap-2 text-sm col-span-2">
                  <input id="toggleHighContrast" type="checkbox" class="checkbox" />
                  <span>High contrast</span>
                </label>
              </div>

              <button id="saveSettings" class="btn col-span-2">Save Settings</button>
            </div>
          </div>
        </div>
      </section>

      <section class="lg:col-span-1">
        <div class="card">
          <div class="card-header flex items-center justify-between">
            <span>Expense Form</span>
            <div class="flex gap-2">
              <button id="newEntryBtn" class="btn-secondary">New</button>
              <button id="validateBtn" class="btn-secondary">Validate</button>
              <button id="addToListBtn" class="btn">Add</button>
            </div>
          </div>
          <div class="card-body">
            <form id="expenseForm" class="grid grid-cols-2 gap-3" autocomplete="off">
              <label class="block">
                <span class="label">Date</span>
                <input name="date" type="date" class="input" required />
              </label>
              <label class="block">
                <span class="label">Vendor</span>
                <input name="vendor" class="input" placeholder="Merchant" />
              </label>
              <label class="block">
                <span class="label">Description</span>
                <input name="description" class="input" placeholder="What was this?" />
              </label>
              <label class="block">
                <span class="label">Category</span>
                <input name="category" class="input" list="categoryList" placeholder="Select or type…" />
                <datalist id="categoryList"></datalist>
              </label>
              <label class="block">
                <span class="label">Subcategory</span>
                <input name="subcategory" class="input" placeholder="Optional" />
              </label>
              <label class="block">
                <span class="label">Amount</span>
                <input name="amount" type="number" step="0.01" class="input" required />
              </label>
              <label class="block">
                <span class="label">Currency</span>
                <input name="currency" class="input" value="PHP" />
              </label>
              <label class="block">
                <span class="label">Payment Method</span>
                <input name="payment_method" class="input" placeholder="e.g. Lloyd CC" />
              </label>
              <label class="block">
                <span class="label">Invoice #</span>
                <input name="invoice_number" class="input" />
              </label>
              <label class="block">
                <span class="label">Reference ID</span>
                <input name="reference_id" class="input" />
              </label>
              <label class="block">
                <span class="label">Tax Amount</span>
                <input name="tax_amount" type="number" step="0.01" class="input" value="0" />
              </label>
              <label class="block">
                <span class="label">Tip Amount</span>
                <input name="tip_amount" type="number" step="0.01" class="input" value="0" />
              </label>
              <label class="block">
                <span class="label">Location</span>
                <input name="location" class="input" />
              </label>
              <label class="block col-span-2">
                <span class="label">Notes</span>
                <textarea name="notes" rows="2" class="textarea"></textarea>
              </label>
              <input type="hidden" name="source_type" />
              <input type="hidden" name="source_filename" />
              <input type="hidden" name="attachment_drive_file_id" />
              <input type="hidden" name="created_at" />
              <input type="hidden" name="processed_at" />
              <input type="hidden" name="validated" />
              <input type="hidden" name="validation_errors" />
            </form>
            <div id="formErrors" class="mt-2 text-sm text-red-600"></div>
          </div>
        </div>
      </section>

      <section class="lg:col-span-1 space-y-4">
        <div class="card">
          <div class="card-header flex items-center justify-between">
            <span>Preview & Batch</span>
            <div class="flex gap-2">
              <button id="validateAllBtn" class="btn-secondary">Validate All</button>
              <button id="dedupeBtn" class="btn-secondary">Deduplicate</button>
            </div>
          </div>
          <div class="card-body">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-neutral-600">
                <span id="recordCount">0</span> items · Total <span id="recordTotal">₱0.00</span>
              </div>
              <div class="flex gap-2">
                <button id="exportJsonBtn" class="btn-secondary">Export JSON</button>
                <button id="exportCsvBtn" class="btn-secondary">Export CSV</button>
                <button id="uploadDriveBtn" class="btn">Upload to Drive</button>
              </div>
            </div>
            <div class="overflow-auto max-h-[50vh] border rounded">
              <table class="w-full text-sm">
                <thead class="bg-neutral-100 sticky top-0">
                  <tr>
                    <th class="th">Date</th>
                    <th class="th">Vendor</th>
                    <th class="th">Category</th>
                    <th class="th">Amount</th>
                    <th class="th">Status</th>
                    <th class="th">Actions</th>
                  </tr>
                </thead>
                <tbody id="previewTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="mx-auto max-w-7xl px-4 py-6 text-xs text-neutral-500">
      Privacy-first: all OCR runs locally unless you enable LLM.
    </footer>

    <script type="module" src="./app.js"></script>
  </body>
</html>
